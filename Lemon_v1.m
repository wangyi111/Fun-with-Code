%% Lemon_v1
% simulated from numbered musical notation
% author: YI WANG
% last change: 04/03/2019

clear;
clc;
degree=3;
fs=10125;

% do re mi fa so la si
% 1 2 3 4 5 6 7
% C D E F G A B
l=[123.471,138.591,155.563,164.814,184.997,207.652,233.082];
ls=[130.813,146.832,0,174.614,195.998,220.000];
m=[246.942,277.183,311.127,329.628,369.994,415.305,466.164];
ms=[261.626,293.665,0,349.228,391.995,440.000];
h=[493.883,554.365,622.254,659.255,739.989,830.609,932.328];
hs=[523.251,587.330,0,698.456,783.991,880.000];
hh=[987.767,1108.731,1244.508,1318.51,1479.978,1661.219,1864.655];
hhs=[1046.502,1174.659,0,1396.913,1567.982,1760];

% 1=bA
ma=[207.652,233.082,261.626,277.183,311.127,349.228,391.995];
mas=[220.000,246.942,0,293.665,329.628,369.994];
ha=[415.305,466.164,523.251,554.365,622.254,698.456,783.991];
has=[440.000,493.883,0,587.330,659.255,739.989];
hha=[830.609,932.328,1046.502,1108.731,1244.508,1396.913,1567.982];
hhas=[880.000,987.767,0,1174.659,1318.510,1479.978];


special(19)=hhas(4);



h_tonel=[
    0 0 0 h(1) h(2) ...
    h(3) h(1) m(6) h(2) ...
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ... 
    m(3) m(2) m(3) ...
    m(4) h(1) m(7) h(1) ...
    m(5) m(4) m(3) m(4) ...
    ms(4) h(1) m(7) m(6) ... 
    ms(5) h(1) h(2) ...
    h(3) h(1) m(6) h(2) ...
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ... 
    m(3) m(2) m(3) ...
    m(4) m(5) m(4) m(5) ...
    m(3) m(5) h(1) h(3) ...
    h(2) h(2) h(2) h(1) h(1) ... 
    h(1) ...                              part1
    0 0 0 0 ...
    0 0 0 h(1) h(2) ...
    h(3) h(1) m(6) h(2) ... 
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ...
    m(3) m(2) m(3) ...
    m(4) h(1) m(7) h(1) ... 
    m(5) m(4) m(3) m(4) ...
    ms(4) h(1) m(7) m(6) ...
    ms(5) h(1) h(2) ...
    h(3) h(1) m(6) h(2) ... 
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ...
    m(3) m(2) m(3) ...
    m(4) m(5) m(4) m(5) ... 
    m(3) m(5) h(1) h(3) ...
    h(2) h(2) h(2) h(1) h(1) ...
    h(1) ...                              part2    
    m(6) m(7) h(1) m(7) m(6) ... 
    m(5) h(3) h(3) ...
    h(2) h(3) h(4) h(3) h(2) ...
    h(1) h(2) m(5) ...
    m(4) m(5) m(6) m(5) m(4) ... 
    m(3) h(1) h(1) h(1) ...
    m(7) m(6) m(7) ...                    part3
    h(1) 0 h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ...
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(5) h(6) h(5) h(5) hhas(2) ...appoggiatura
    h(7) h(5) h(3) h(5) h(2) ...
    h(2) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(2) h(1) h(1) h(1) h(2) h(3) ...
    h(4) h(3) h(3) h(2) m(7) ...
    h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ... 
    h(1) m(5) m(3) m(5) ...
    m(6) h(2) m(7) h(1) ...
    h(1) h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ... 
    h(1) m(5) h(1) h(2) ...
    h(3) h(4) h(2) h(1) ...
    h(1) 0 ...                            part4
    h(3) h(1) h(5) h(1) ... 
    h(1) h(2) h(5) h(1) ...
    h(1) h(2) h(5) h(1) ...
    h(1) h(2) h(3) h(1) ...
    h(2) h(5) h(1) ... 
    h(1) h(2) h(5) h(1) ...
    hs(2) h(1) ...
    h(2) h(1) h(2) ...                   (part5)
    h(3) h(1) m(6) h(2) ... 
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ...
    m(3) m(2) m(3) ...
    m(4) h(1) m(7) h(1) ... 
    m(5) m(4) m(3) m(4) ...
    ms(4) h(1) m(7) m(6) ...
    ms(5) h(1) h(2) ...             
    h(3) h(1) m(6) h(2) ... 
    m(7) m(5) m(3) m(7) ...
    m(6) m(5) m(1) m(5) ...
    m(3) m(2) m(3) ...
    m(4) m(5) m(4) m(5) ... 
    m(3) m(5) h(1) h(3) ...
    h(2) h(3) h(3) h(2) h(1) ...
    h(1) ...                              part6
    m(6) m(7) h(1) m(7) m(6) ... 
    m(5) h(3) h(3) ...
    h(2) h(3) h(4) h(3) h(2) ...
    h(1) h(2) m(5) ...
    m(4) m(5) m(6) m(5) m(4) ... 
    m(3) h(1) h(1) h(1) ...
    m(7) m(6) m(7) ...                    part7
    h(1) 0 h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ...
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(5) h(6) h(5) h(5) hhas(2) ...appoggiatura
    h(7) h(5) h(3) h(5) h(2) ...
    h(2) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(2) h(1) h(1) h(2) h(3) ...
    h(4) h(3) h(3) h(2) m(7) ...   
    h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ... 
    h(1) m(5) m(3) m(5) ...
    m(6) h(2) m(7) h(1) ...
    h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ... 
    h(1) m(5) h(1) h(2) ...
    h(3) h(4) h(2) h(1) ...
    h(1) ...                             part8
    ha(1) ha(5) ...%%1=bA
    ha(6) ha(5) ...
    ha(2) ha(4) ... 
    ha(3) ...
    ha(1) ha(3) ...
    ha(4) ha(3) ...
    ha(2) ma(7) ... 
    ha(1) ...
    ha(1) ha(5) ...
    ha(6) ha(5) ...
    ha(2) ha(4) ha(3) ...     
    ha(3) ...
    ha(1) ha(3) ...
    ha(4) ha(3) ...
    ha(2) ma(7) ... 
    ha(1) 0 ma(6) ma(7) ...
    ha(1) ha(5) ...
    ha(6) ha(5) ha(2) ...
    ha(2) ha(4) ha(3) ... 
    ha(3) ...
    ha(1) ha(3) ...
    ha(4) ha(3) ...
    ha(2) ma(7) ...     
    ha(1) ma(6) ma(7) ...
    ha(1) ha(5) ...
    ha(6) ha(5) ...
    ha(7) ha(7) hha(1)... 
    hha(1) ...
    hha(1) ha(5) ...
    ha(4) ha(3) ha(2) ...
    ha(2) has(2) ... 
    h(1) ...                            part9    
    0 h(2) h(3) h(2) h(1) ...%%1=B?   
    m(6) h(1) h(3) h(5) ...
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ... 
    h(2) h(1) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ...
    h(5) h(6) h(5) h(5) hh(1) ...appoggiatura
    h(7) h(5) h(3) h(5) ... 
    h(2) h(2) h(3) h(2) h(1) ...
    m(6) h(1) h(3) h(5) ...
    h(2) h(1) h(1) h(1) h(2) h(3) ...
    h(6) h(3) h(3) h(2) m(7) ... 
    h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ...
    h(1) m(5) m(3) m(5) ...
    m(6) h(2) m(7) h(1) ... 
    h(1) h(1) m(7) ...
    m(6) m(7) h(1) h(2) ...
    h(1) m(5) m(4) h(3) ...
    h(4) h(1) h(1) h(5) ... 
    h(3) h(3) h(2) ...
    h(1) h(2) h(3) h(4) ...
    h(3) h(1) m(5) m(3) ...
    h(2) h(3) h(2) h(1) ... 
    h(1) ...                            part10
                     
    ];

h_beat1=[
    2 2 2 1 1 ...
    2 1 3 2 ...
    2 1 3 2 ...
    2 1 3 2 ... 
    6 1 1 ...
    4 2 4/3 2/3 ...
    4 2 1.5 0.5 ...
    4 2 4/3 2/3 ... 
    6 1 1 ...
    2 1 3 2 ...
    2 1 3 2 ...
    2 1 3 2 ... 
    6 1 1 ...
    4 2 4/3 2/3 ...
    2 2 2 2 ...
    3 1 1 2 1 ... 
    8 ...                 part1
    2 2 2 2 ...
    2 2 2 1 1 ...
    2 1 3 2 ... 
    2 1 3 2 ...
    2 1 3 2 ...
    6 1 1 ...
    4 2 1 1 ... 
    4 2 1.5 0.5 ...
    4 2 4/3 2/3 ...
    6 1 1 ...
    2 1 3 2 ... 
    2 1 3 2 ...
    2 1 3 2 ...
    6 1 1 ...
    4 2 4/3 2/3 ... 
    2 2 2 2 ...
    1 3 1.5 0.5 2 ...
    8 ...                     part2
    3 1 2 1 1 ... 
    2 2 4 ...
    3 1 2 1 1 ...
    2 2 4 ...
    3 1 2 1 1 ... 
    2 2 2 2 ...
    4 2 2 ...                 part3
    2 2 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ... 
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ...
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ... 
    0.25 0.75 3 1 3 ...appoggiatura
    1 3 1 2 1 ...
    4 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ... 
    1 3 1.5 0.5 1.5 0.5 ...
    1.5 0.5+2 1/3 7/3 4/3 ...
    6 1.5 0.5 ...
    2 2 2 2 ... 
    2 2 4/3 8/3 ...
    1.5 0.5+2 1.5 0.5+2 ...
    4 2 1.5 0.5 ...
    2 2 2 2 ... 
    2 2 8/3 4/3 ...
    1.5 0.5+2 1.5 0.5+2 ...
    6 2 ...                   part4
    2 2 2 2 ... 
    2 2 2 2 ...
    2 2 2 2 ...
    2 2 2 2 ...
    4 2 2 ... 
    2 2 2 2 ...
    4 4 ...
    6 4/3 2/3 ...            (part5)
    2 1 3 2 ... 
    2 1 3 2 ...
    2 1 3 2 ...
    6 1 1 ...
    4 2 1 1 ... 
    4 2 1.5 0.5 ...
    4 2 4/3 2/3 ...
    6 1 1 ...
    2 1 3 2 ... 
    2 1 3 2 ...
    2 1 3 2 ...
    6 1 1 ...
    4 2 4/3 2/3 ... 
    2 2 2 2 ...
    1.5 0.5+2 0.25 1.25 2.5 ...
    8 ...                      part6
    3 1 2 1 1 ... 
    2 2 4 ...
    3 1 2 1 1 ...
    2 2 4 ...
    3 1 2 1 1 ... 
    2 2 2 2 ...
    4 2 2 ...                  part7
    2 2 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ... 
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ...
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 0.5+2 ... 
    0.25 0.75 3 1 3 ...
    1 3 1 2 1 ...
    4 1.5 0.5 1.5 0.5 ...
    1 3 1.5 2.5 ... 
    1 3 2 1.5 0.5 ...
    1.5 2.5 1/3 1 8/3 ...
    6 1.5 0.5 ...
    2 2 2 2 ... 
    2 2 4/3 8/3 ...
    1.5 2.5 1.5 2.5 ...
    6 1.5 0.5 ...
    2 2 2 2 ... 
    2 2 4/3 8/3 ...
    1.5 2.5 1.5 2.5 ...
    8 ...                     part8           
    4 4 ...%%1=bA
    4 4 ...
    4 4 ... 
    8 ...
    4 4 ...
    4 4 ...
    4 4 ... 
    8 ...
    4 4 ...
    4 4 ...
    4 2 2 ... 
    8 ...
    4 4 ...
    4 4 ...
    4 4 ...     
    4 1 2 1 ...
    4 4 ...
    4 2 2 ...
    4 2 2 ... 
    8 ...
    4 4 ...
    4 4 ...
    4 4 ... 
    6 1 1 ...
    4 4 ...
    4 4 ...
    4 2 2 ... 
    8 ...
    4 4 ...
    4 2 2 ...
    4 4 ... 
    11 ...                     part9
    2 1.5 0.5 1.5 0.5 ...%%1=B
    1 3 1 3 ...
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 2.5 ... 
    1 3 1.5 0.5 1.5 0.5 ...
    1 3 1.5 2.5 ...
    0.25 0.75 3 1 3 ...
    1 3 1 3 ... 
    4 1.5 0.5 1.5 0.5 ...
    1 3 1.5 2.5 ...
    1 3 1.5 0.5 1.5 0.5 ...
    1.5 2.5 1/3 1 8/3 ... 
    6 1.5 0.5 ...
    2 2 2 2 ...
    2 2 4/3 8/3 ...
    1.5 2.5 1.5 2.5 ... 
    6 1.5 0.5 ...
    2 2 2 2 ...
    2 2 4/3 8/3 ...
    1.5 2.5 1.5 2.5 ... 
    6 1.5 0.5 ...
    2 2 2 2 ...
    2 2 8/3 4/3 ...
    1.5 2.5 1.5 2.5 ... 
    8 ...                     part10
                      
    
    ]/degree;

music_vector=generator(fs,h_tonel,h_beat1);
sound(music_vector,fs);


function music_vector = generator(fs, treble, treble_duration)

speed_factor = 2;      % cpu speed compensation factor

treble_vector = zeros(1,ceil(sum(treble_duration)*fs)+1);  % treble vector generator
n1 = 1;                                              % starting index
for kk = 1:length(treble)
	freq = treble(kk);

%%% single basic wave
% 	if freq==0
%         A=0;
%     else
%         A=2;
%     end
%	tone = A * cos( 2* pi* freq* tt);                      % tone generator
    
    dur=treble_duration(kk)/speed_factor;
	tt = 0 : (1/fs) : (dur);  % duration generator
    
%%% fanyin harmonic waves
%     t1=0.148*dur;
%     t2=0.222*dur;
%     t3=0.815*dur;   
%     et=0.5*interp1([0,t1,t2,t3,dur],[0,1,0.783,0.696,0],tt);
%     tone=et.*cos(2*pi*freq*tt)+et/10.*cos(2*pi*freq/3*tt)+et/20.*cos(2*pi*freq/5*tt);

%%% piano: fanyin&beta envelope
    Nd=8; %Num of fanyin 
    d=3;  %attenuation of fanyin
    temp1=sin(tt'*2*pi*freq*(1:Nd))./(ones(length(tt),1)*d.^(1:Nd));%泛音
    a=1.4; %beta distribution
    b=3;
    score=log2(freq/440)*12;
    temp=sum(temp1,2).*betapdf(tt'/dur,a-score/100,b+score/20);   
    tone=temp';


	n2 = n1 + length(tone) - 1;                            % ending index & concatenate vector
	treble_vector(n1:n2) = treble_vector(n1:n2) + tone;    % vector generator
	n1 = n2;                                               % reset index
end

music_vector = treble_vector;      % treble and bass vector combination

end
